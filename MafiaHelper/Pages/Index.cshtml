@page
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

<div class="max-w-md mx-auto bg-white rounded-xl shadow-md overflow-hidden p-6">
    <h2 class="text-xl font-bold mb-4">Join Mafia Game</h2>

    <div class="space-y-4">
        <input id="name"
               type="text"
               placeholder="Your name"
               class="w-full px-4 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-indigo-400" />

        <button id="join"
                class="w-full bg-indigo-600 text-white py-2 rounded hover:bg-indigo-700 transition">
            Connect
        </button>

        <div id="status" class="text-green-600 font-medium"></div>
        <div id="role" class="text-lg font-semibold mt-2"></div>
    </div>
</div>

@section Scripts {
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/7.0.0/signalr.min.js"></script>
    <script>
        const conn = new signalR.HubConnectionBuilder()
          .withUrl("/gamehub")
          .build();

        conn.on("RoleAssigned", role => {
          document.getElementById("role").textContent =
            "Your role is: " + role;
        });

        document.getElementById("join")
          .addEventListener("click", async () => {
            const name = document.getElementById("name").value.trim();
            if (!name) {
              return alert("Please enter a name");
            }
            try {
              await conn.invoke("Join", name);
              document.getElementById("join").disabled = true;
              document.getElementById("status").textContent =
                "✅ You’re in! Waiting for GM to deal roles…";
            } catch (err) {
              console.error(err.toString());
              alert("Could not connect—check the console for details.");
            }
          });

        conn.start().catch(err => console.error("Connection failed: ", err));
    </script>
}
